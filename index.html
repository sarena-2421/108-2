<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>108Ë™≤Á∂±Â≠∏Ê∏¨ÂúãÊñáÊ®°Êì¨App - Á∂úÂêàÊ∏¨È©ó</title>
    <!-- ÂºïÂÖ• React Âíå ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- ÂºïÂÖ• Babel Áî®ÊñºËß£Êûê JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- ÂºïÂÖ• Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .font-serif { font-family: 'Noto Serif TC', serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100 h-screen w-full flex justify-center items-center overflow-hidden">
    <div id="root" class="w-full max-w-2xl h-full bg-white shadow-2xl relative"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // -----------------------------------------------------------------------------
        // 0. ÂÖßÂª∫ÂúñÊ®ôÂÖÉ‰ª∂ (ÁßªÈô§ lucide-react ‰æùË≥¥)
        // -----------------------------------------------------------------------------
        const Icons = {
            Clock: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            BookOpen: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
            CheckCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            XCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>,
            AlertCircle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>,
            BarChart2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="18" x2="18" y1="20" y2="10"/><line x1="12" x2="12" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="14"/></svg>,
            ChevronRight: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m9 18 6-6-6-6"/></svg>,
            ChevronLeft: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m15 18-6-6 6-6"/></svg>,
            RotateCcw: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Home: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Award: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
            Grid: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            Flag: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" x2="4" y1="22" y2="15"/></svg>,
            Search: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/></svg>,
            Menu: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            Zap: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        };

        // Ëß£ÊßãË≥¶ÂÄºËÆìÁ®ãÂºèÁ¢ºÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®ÂÖÉ‰ª∂ÂêçÁ®±
        const { Clock, BookOpen, CheckCircle, XCircle, AlertCircle, BarChart2, ChevronRight, ChevronLeft, RotateCcw, Home, Award, Grid, Flag, Search, Menu, Zap } = Icons;

        // -----------------------------------------------------------------------------
        // 1. ÁúüÂØ¶È°åÂ∫´ÁØÑ‰æã
        // -----------------------------------------------------------------------------
        const REAL_QUESTION_EXAMPLES = [
            {
                id: 'real_1',
                type: 'single',
                category: 'Â≠óÈü≥Â≠óÂΩ¢',
                text: '‰∏ãÂàóÂêÑÁµÑ„Äå„ÄçÂÖßÁöÑÂ≠óÔºåËÆÄÈü≥ÂÆåÂÖ®Áõ∏ÂêåÁöÑÊòØÔºö',
                options: [
                    '„ÄåË£®„ÄçË£úÈóïÊºè / „Äå‰øæ„ÄçÂÄ™Áúæ‰∫∫ / „ÄåÂ©¢„ÄçËÜùÂ•¥È°è',
                    '„ÄåËºâ„ÄçÊ≠åËºâËàû / ÂçÉ„ÄåËºâ„ÄçÈõ£ÈÄ¢ / ÊÄ®ËÅ≤„ÄåËºâ„ÄçÈÅì',
                    '„ÄåÊúî„ÄçÊ∞£ÂÇ≥ÈáëÊüù / Êí≤„ÄåÊúî„ÄçËø∑Èõ¢ / Ê©´„ÄåÊßä„ÄçË≥¶Ë©©',
                    '„ÄåËàá„ÄçÊ∞ëÂêåÊ®Ç / „ÄåËàá„ÄçÂÖ∂Â¶ÇÊ≠§ / Ê≠≤‰∏çÊàë„ÄåËàá„Äç'
                ],
                correctAnswer: [2],
                explanation: 'A. „ÑÖ„ÑßÀã / „ÑÖ„ÑßÀã / „ÑÖ„ÑßÀã (Ê≠£Á¢∫)Ôºõ B. „Ñó„ÑûÀã / „Ñó„ÑûÀá / „Ñó„ÑûÀãÔºõ C. „Ñï„Ñ®„ÑõÀã / „Ñï„Ñ®„ÑõÀã / „Ñï„Ñ®„ÑõÀã (Ê≠£Á¢∫)Ôºõ D. „Ñ©Àá / „Ñ©Àá / „Ñ©Àá (ÈÅ∏È†ÖCÊúî„ÄÅÊßäÁöÜËÆÄ„Ñï„Ñ®„ÑõÀãÔºåÊúÄÁÇ∫Á≤æÁ¢∫)',
                difficulty: '‰∏≠'
            },
            {
                id: 'real_2',
                type: 'single',
                category: 'ÊàêË™ûÊáâÁî®',
                text: '‰∏ãÂàóÊñáÂè•„Äå„ÄçÂÖßÁöÑÊàêË™ûÔºå‰ΩøÁî®ÊúÄÊÅ∞Áï∂ÁöÑÊòØÔºö',
                options: [
                    'ÈÄôÈÉ®ÈõªÂΩ±ÊÉÖÁØÄÁ∑äÊπäÔºåÈ´òÊΩÆËø≠Ëµ∑ÔºåÁúüÊòØ„ÄåÁΩÑÁ´πÈõ£Êõ∏„Äç„ÄÇ',
                    '‰ªñÂ∞çÊñºÈÄô‰ª∂‰∫ãÁöÑÂßãÊú´Ë™™ÊòéÂæó„ÄåÁπ™ËÅ≤Áπ™ÂΩ±„ÄçÔºåËÆì‰∫∫ÂΩ∑ÂΩøË∫´Ê≠∑ÂÖ∂Â¢É„ÄÇ',
                    'Èù¢Â∞çÂº∑ÊïµÂ£ìÂ¢ÉÔºåÂ∞áËªçÊ±∫ÂÆö„ÄåÁ†¥ÈáúÊ≤âËàü„ÄçÔºåËàáÂüéÂÖ±Â≠ò‰∫°„ÄÇ',
                    'ÈõñÁÑ∂‰ªñÁäØ‰∫ÜÈåØÔºå‰ΩÜÂè™Ë¶ÅËÉΩ„ÄåÈ£üË®ÄËÄåËÇ•„ÄçÔºåÂ§ßÂÆ∂ÈÇÑÊòØÊúÉÂéüË´í‰ªñÁöÑ„ÄÇ'
                ],
                correctAnswer: [2],
                explanation: 'A. ÁΩÑÁ´πÈõ£Êõ∏ÂΩ¢ÂÆπÁΩ™ÊÉ°Ê•µÂ§ö„ÄÇ B. Áπ™ËÅ≤Áπ™ÂΩ±ÈõñÂèØÂΩ¢ÂÆπÁîüÂãïÔºå‰ΩÜ‰∫¶ÊúâÂä†Ê≤πÊ∑ªÈÜã‰πãÊÑèÔºåC‰πãÁ†¥ÈáúÊ≤âËàüÂΩ¢ÂÆπÊ±∫ÂøÉÊõ¥ÁÇ∫Á≤æÁ¢∫ÊÅ∞Áï∂„ÄÇ C. Á†¥ÈáúÊ≤âËàüÂΩ¢ÂÆπÂÅö‰∫ãÊûúÊ±∫„ÄÇ D. È£üË®ÄËÄåËÇ•Êåá‰∏çÂÆà‰ø°Áî®„ÄÇ',
                difficulty: 'Êòì'
            },
            {
                id: 'real_3',
                type: 'group',
                category: 'Èñ±ËÆÄÁ¥†È§ä',
                passageTitle: 'ÈóúÊñº„ÄåÂ≠§Áç®„ÄçÁöÑÁèæ‰ª£ËàáÂè§ÂÖ∏Â∞çË©±',
                passageContent: `(Áî≤) ËéäÂ≠êË™™Ôºö„ÄåÁç®ËàáÂ§©Âú∞Á≤æÁ•ûÂæÄ‰æÜÔºåËÄå‰∏çÊïñÂÄ™ÊñºËê¨Áâ©„ÄÇ„ÄçÈÄôÊòØ‰∏ÄÁ®ÆÂ¥áÈ´òÁöÑÂ≠§Áç®„ÄÇÂú®ËéäÂ≠êÁúã‰æÜÔºå‰∫∫Âè™ÊúâÂú®Â≠§Áç®‰∏≠ÔºåÊâçËÉΩÂæûÁ§æÊúÉÈóú‰øÇÁöÑÁ∂≤ÁæÖË£°Ëß£ËÑ´Âá∫‰æÜÔºåÊÅ¢Âæ©ÁîüÂëΩÁöÑÊú¨ÁúüÔºåËàáÂ§©Âú∞Ëê¨Áâ©ÂêàËÄåÁÇ∫‰∏Ä„ÄÇ

(‰πô) Áèæ‰ª£Á§æÊúÉÂ≠∏ÂÆ∂Â§ßË°õ¬∑ÈáåÊñØÊõºÂú®„ÄäÂØÇÂØûÁöÑÁæ§Áúæ„Äã‰∏≠ÊåáÂá∫ÔºåÁèæ‰ª£‰∫∫ÂæÄÂæÄÊòØ„Äå‰ªñ‰∫∫Â∞éÂêë„ÄçÁöÑÔºåÊàëÂÄëÊïèÈä≥Âú∞ÊçïÊçâ‰ªñ‰∫∫ÁöÑÊúüÂæÖËàáË©ïÂÉπ„ÄÇÊàëÂÄëË∫´Ëôï‰∫∫Áæ§‰πã‰∏≠ÔºåÂçªÊÑüÂà∞ÂâçÊâÄÊú™ÊúâÁöÑÂ≠§Áç®„ÄÇÈÄôÁ®ÆÂ≠§Áç®Ê∫êÊñºËàáÁúüÂØ¶Ëá™ÊàëÁöÑÁñèÈõ¢„ÄÇ`,
                questions: [
                    {
                        id: 'real_3_1',
                        type: 'single',
                        text: 'Ê†πÊìö(Áî≤)ÊñáÔºåËéäÂ≠êÊâÄË™çÁÇ∫ÁöÑ„ÄåÂ≠§Áç®„ÄçÂÖ∑Êúâ‰ΩïÁ®ÆÁâπË≥™Ôºü',
                        options: [
                            'ÊòØË¢´‰∫∫ÊéíÊì†ÂæåÁöÑÁÑ°Â•àÁãÄÊÖã',
                            'ÊòØ‰∏ÄÁ®ÆÂÇ≤Ë¶ñËê¨Áâ©„ÄÅÂîØÊàëÁç®Â∞äÁöÑÊÖãÂ∫¶',
                            'ÊòØÊì∫ËÑ´Á§æÊúÉÊùüÁ∏õÔºåÂõûÊ≠∏ÁîüÂëΩÊú¨ÁúüÁöÑÈÄîÂæë',
                            'ÊòØÁÇ∫‰∫ÜÂàáÊñ∑ËàáÂ§ñÁïåÁöÑÊâÄÊúâËÅØÁπ´'
                        ],
                        correctAnswer: [2],
                        explanation: 'Êñá‰∏≠ÊèêÂà∞„ÄåÂæûÁ§æÊúÉÈóú‰øÇÁöÑÁ∂≤ÁæÖË£°Ëß£ËÑ´Âá∫‰æÜÔºåÊÅ¢Âæ©ÁîüÂëΩÁöÑÊú¨Áúü„ÄçÔºåÊïÖÈÅ∏C„ÄÇ'
                    },
                    {
                        id: 'real_3_2',
                        type: 'single',
                        text: 'Á∂úÂêà(Áî≤)„ÄÅ(‰πô)‰∫åÊñáÔºå‰∏ãÂàóÊïòËø∞‰ΩïËÄÖÊúÄÁÇ∫ÈÅ©Áï∂Ôºü',
                        options: [
                            'ËéäÂ≠êËàáÈáåÊñØÊõºÈÉΩË™çÁÇ∫Â≠§Áç®ÊòØË≤†Èù¢ÁöÑÂøÉÁêÜÁãÄÊÖã',
                            'ËéäÂ≠êÁöÑÂ≠§Áç®ÊòØÁ≤æÁ•ûÁöÑÂÖÖÂØ¶ÔºåÁèæ‰ª£‰∫∫ÁöÑÂ≠§Áç®Â∏∏ÊòØËá™ÊàëÁöÑËø∑Â§±',
                            'Áèæ‰ª£ÁßëÊäÄÂèØ‰ª•Ëß£Ê±∫ËéäÂ≠êÊâÄË™™ÁöÑÂ≠§Áç®ÂïèÈ°å',
                            'ÈáåÊñØÊõºË™çÁÇ∫„Äå‰ªñ‰∫∫Â∞éÂêë„ÄçÊúâÂä©ÊñºÊ∂àÈô§Â≠§Áç®ÊÑü'
                        ],
                        correctAnswer: [1],
                        explanation: 'ËéäÂ≠êÁöÑÂ≠§Áç®ÊòØ„ÄåËàáÂ§©Âú∞Á≤æÁ•ûÂæÄ‰æÜ„Äç(ÂÖÖÂØ¶)ÔºõÈáåÊñØÊõºÊåáÂá∫Áèæ‰ª£‰∫∫„ÄåË∫´Ëôï‰∫∫Áæ§ÂçªÊÑüÂà∞Â≠§Áç®„ÄçÔºåÊ∫êÊñº„ÄåËàáÁúüÂØ¶Ëá™ÊàëÁöÑÁñèÈõ¢„Äç(Ëø∑Â§±)„ÄÇ'
                    }
                ]
            },
            {
                id: 'real_4',
                type: 'multi',
                category: 'Âè§ÊñáÂçÅ‰∫îÁØá',
                text: 'ÈóúÊñº„ÄäËµ§Â£ÅË≥¶„ÄãËàá„ÄäÂßãÂæóË•øÂ±±ÂÆ¥ÈÅäË®ò„ÄãÁöÑÊØîËºÉÔºå‰∏ãÂàóÊïòËø∞Âì™‰∫õÊ≠£Á¢∫Ôºü',
                options: [
                    '‰∫åÊñáÁöÜÁÇ∫Ë≤∂Ë¨´ÊôÇÊúüÁöÑ‰ΩúÂìÅ',
                    'ËòáËªæÂú®„ÄäËµ§Â£ÅË≥¶„Äã‰∏≠‰ª•„ÄåÊ∞¥„ÄÅÊúà„ÄçÁÇ∫ÂñªÔºåÈó°Ëø∞ËÆäËàá‰∏çËÆäÁöÑÂì≤ÁêÜ',
                    'Êü≥ÂÆóÂÖÉÂú®„ÄäÂßãÂæóË•øÂ±±ÂÆ¥ÈÅäË®ò„Äã‰∏≠ÔºåÈÄèÈÅéËàáËê¨Áâ©ÂÜ•ÂêàÔºåÂåñËß£‰∫ÜÂøÉ‰∏≠ÁöÑÊÜÇÊáº',
                    '‰∫åÊñáÊúÄÁµÇÈÉΩÊµÅÈú≤Âá∫Â∞çÁèæÂØ¶ÊîøÊ≤ªÁöÑÂº∑ÁÉàÊâπÂà§Ëàá‰∏çÊªøÔºåÁÑ°Ê≥ïÈáãÊá∑',
                    '‰∫åÊñáÁöÜÂ§ßÈáèÈÅãÁî®Èß¢ÂÅ∂Âè•ÂºèÔºåË™ûË®ÄËèØÈ∫óÂ†ÜÁ†å'
                ],
                correctAnswer: [0, 1, 2],
                explanation: 'A. Ê≠£Á¢∫ÔºåËòáË≤∂ÈªÉÂ∑ûÔºåÊü≥Ë≤∂Ê∞∏Â∑û„ÄÇ B. Ê≠£Á¢∫„ÄÇ C. Ê≠£Á¢∫ÔºåÂøÉÂáùÂΩ¢Èáã„ÄÇ D. ÈåØË™§Ôºå‰∫åÊñáÁöÜÈÅîÂà∞Á≤æÁ•ûË∂ÖËÑ´„ÄÇ E. ÈåØË™§ÔºåÊü≥ÊñáÈ¢®Ê†ºÂ≥≠Êãî„ÄÇ',
                difficulty: 'Èõ£'
            },
            {
                id: 'real_5',
                type: 'group',
                category: 'ÁßëÊôÆÈñ±ËÆÄ',
                passageTitle: '‰∫∫Â∑•Êô∫ÊÖßËàáÁ•ûÁ∂ìÁ∂≤Áµ°',
                passageContent: `Ê∑±Â∫¶Â≠∏ÁøíÔºàDeep LearningÔºâÊòØÊ©üÂô®Â≠∏ÁøíÁöÑ‰∏ÄÂÄãÂàÜÊîØ... (Ê≠§ËôïÁúÅÁï•ÈÉ®ÂàÜÂÖßÊñá‰ª•ÁØÄÁúÅÁ©∫Èñì)... ÁÑ∂ËÄåÔºåÊ∑±Â∫¶Â≠∏ÁøíÊ®°ÂûãÈÄöÂ∏∏Ë¢´Á®±ÁÇ∫„ÄåÈªëÁõíÂ≠ê„ÄçÔºàBlack BoxÔºâÔºåÂõ†ÁÇ∫Âç≥‰ΩøÊòØË®≠Ë®àËÄÖÔºå‰πüÂæÄÂæÄÈõ£‰ª•Ëß£ÈáãÁ•ûÁ∂ìÁ∂≤Áµ°ÂÖßÈÉ®ÂÖ∑È´îÊòØÂ¶Ç‰ΩïÂÅöÂá∫ÊüêÂÄãÊ±∫Á≠ñÁöÑ„ÄÇ`,
                questions: [
                    {
                        id: 'real_5_1',
                        type: 'single',
                        text: 'Ê†πÊìöÊú¨ÊñáÔºåÊ∑±Â∫¶Â≠∏ÁøíËàáÂÇ≥Áµ±ÊºîÁÆóÊ≥ïÁöÑ‰∏ªË¶ÅÂ∑ÆÁï∞ÁÇ∫‰ΩïÔºü',
                        options: [
                            'Ê∑±Â∫¶Â≠∏ÁøíÂÆåÂÖ®‰∏çÈúÄË¶Å‰ªª‰ΩïÊï∏Êìö',
                            'ÂÇ≥Áµ±ÊºîÁÆóÊ≥ïÊ®°‰ªø‰∫∫È°ûÂ§ßËÖ¶ÔºåÊ∑±Â∫¶Â≠∏ÁøíÂâáÂê¶',
                            'Ê∑±Â∫¶Â≠∏ÁøíËÉΩËá™ÂãïÂæûÊï∏Êìö‰∏≠Â≠∏ÁøíÁâπÂæµ',
                            'ÂÇ≥Áµ±ÊºîÁÆóÊ≥ïÊòØÈªëÁõíÂ≠ê'
                        ],
                        correctAnswer: [2],
                        explanation: 'Ëá™ÂãïÂæûÊµ∑ÈáèÊï∏Êìö‰∏≠Â≠∏ÁøíÁâπÂæµ„ÄÇ'
                    },
                    {
                        id: 'real_5_2',
                        type: 'multi',
                        text: 'ÈóúÊñº„ÄåÈªëÁõíÂ≠ê„ÄçÂïèÈ°åÔºå‰∏ãÂàóÊé®Ë´ñÂì™‰∫õÂêàÁêÜÔºü',
                        options: [
                            'ÂèØËÉΩÂåÖÂê´‰∫∫È°ûÊú™Áü•ÁöÑÂÅèË¶ã',
                            'ÈÅã‰ΩúÈÇèËºØ‰∏çÂ§†ÈÄèÊòé',
                            'Â¢ûÂä†Êï∏ÊìöÈáèËÉΩËß£Ê±∫Ëß£ÈáãÊÄßÂïèÈ°å',
                            'Âú®ÈÜ´ÁôÇÊ≥ïÂæãÈ†òÂüüÊáâÁî®ÊúÉÁî¢ÁîüÁñëÊÖÆ'
                        ],
                        correctAnswer: [0, 1, 3],
                        explanation: 'Â¢ûÂä†Êï∏ÊìöÈáèÁÑ°Ê≥ïËß£Ê±∫ÈªëÁõíÂ≠ê(ÂèØËß£ÈáãÊÄß)ÂïèÈ°å„ÄÇ'
                    }
                ]
            }
        ];

        // -----------------------------------------------------------------------------
        // 2. Êì¥ÂÖÖÁâà‰ªøÁúüÈ°åÂ∫´Ë≥áÊñôÂ∫´
        // -----------------------------------------------------------------------------
        const IDIOMS = [
            'ÂâõÊÑéËá™Áî®', 'Á∑£Êú®Ê±ÇÈ≠ö', 'ÊåâÂúñÁ¥¢È©•', '‰∏ç‰ª•ÁÇ∫ÁÑ∂', 'È¶ñÁï∂ÂÖ∂Ë°ù', 'ÁΩÑÁ´πÈõ£Êõ∏', 'ÁõÆ‰∏çË≠ò‰∏Å', 'Â¶ÑËá™Ëè≤ËñÑ', 'ÈüãÁ∑®‰∏âÁµï', 'Ê¥õÈôΩÁ¥ôË≤¥',
            'Ê±óÁâõÂÖÖÊ£ü', '‰∏â‰ª§‰∫îÁî≥', '‰∏çËÑõËÄåËµ∞', 'ÂàÜÈÅìÊèöÈë£', 'Êú™Èõ®Á∂¢ÁπÜ', 'ÊØè‰∏ãÊÑàÊ≥Å', 'Áõ∏ÂΩ¢Ë¶ãÁµÄ', 'Á¥ÑÂÆö‰øóÊàê', 'Á†¥ÈáúÊ≤âËàü', 'ÂâõÊØÖÊú®Ë®•',
            'ÊåØËÅæÁôºËÅµ', 'ÁîöÂõÇÂ°µ‰∏ä', 'ÁúæÂè£Èë†Èáë', 'Ëé´Ë°∑‰∏ÄÊòØ', 'ËôõËàáÂßîËõá', 'Ë≤∑Ê´ùÈÇÑÁè†', 'ÊªÑÊµ∑Ê°ëÁî∞', 'Áê≥ÁëØÊªøÁõÆ', 'ÈåôÈäñÂøÖËºÉ', 'Ë∂®‰πãËã•È∂©',
            'Êø´Á´ΩÂÖÖÊï∏', 'Ê´õÈ¢®Ê≤êÈõ®', 'ÁùöÁú•ÂøÖÂ†±', 'ÁüØÊèâÈÄ†‰Ωú', 'Ë∫äË∫áÊªøÂøó', 'Ë´±Ëé´Â¶ÇÊ∑±', 'Áç®Ê®π‰∏ÄÂπü', 'Èû≠ËæüÂÖ•Ë£°', '‰∏çËêΩÁ™†Ëáº', 'Âõ†ÂôéÂª¢È£ü'
        ];

        const AUTHORS = [
            { name: 'ËòáËªæ', key: 'Ë±™ÊîæÊ¥æ„ÄÅË≤∂Ë¨´ÊñáÂ≠∏„ÄÅËµ§Â£ÅË≥¶' },
            { name: 'ÈüìÊÑà', key: 'Êñá‰ª•ËºâÈÅì„ÄÅÂè§ÊñáÈÅãÂãï„ÄÅÂ∏´Ë™™' },
            { name: 'Êü≥ÂÆóÂÖÉ', key: 'Ê∞∏Â∑ûÂÖ´Ë®ò„ÄÅÂØìË®Ä„ÄÅÂ±±Ê∞¥ÈÅäË®ò' },
            { name: 'Ê≠êÈôΩËÑ©', key: 'ÈÜâÁøÅ‰∫≠Ë®ò„ÄÅÂÖ≠‰∏ÄÂ±ÖÂ£´„ÄÅÂåóÂÆãÊñáÂ£áÈ†òË¢ñ' },
            { name: 'ÊùéÁôΩ', key: 'Ë©©‰ªô„ÄÅÊµ™Êº´‰∏ªÁæ©„ÄÅÂ∞áÈÄ≤ÈÖí' },
            { name: 'ÊùúÁî´', key: 'Ë©©ËÅñ„ÄÅÁ§æÊúÉÂØ´ÂØ¶„ÄÅ‰∏âÂêè‰∏âÂà•' },
            { name: 'ÁôΩÂ±ÖÊòì', key: 'Êñ∞Ê®ÇÂ∫úÈÅãÂãï„ÄÅÁêµÁê∂Ë°å„ÄÅËÄÅÂ´óËÉΩËß£' },
            { name: 'Ê≠∏ÊúâÂÖâ', key: 'È†ÖËÑäËªíÂøó„ÄÅÈúáÂ∑ùÂÖàÁîü„ÄÅÊòé‰ª£Êï£Êñá' },
            { name: 'Ë¢ÅÂÆèÈÅì', key: 'ÊÄßÈùàË™™„ÄÅÊôöÊòéÂ∞èÂìÅ„ÄÅÂÖ¨ÂÆâÊ¥æ' },
            { name: 'Ë≥¥Âíå', key: 'Âè∞ÁÅ£Êñ∞ÊñáÂ≠∏‰πãÁà∂„ÄÅ‰∏ÄÊ°øÁ®±‰ªî' },
            { name: 'Èô∂Ê∑µÊòé', key: 'Èö±ÈÄ∏Ë©©‰∫∫„ÄÅÊ°ÉËä±Ê∫êË®ò„ÄÅ‰∏çÁÇ∫‰∫îÊñóÁ±≥ÊäòËÖ∞' },
            { name: 'Â±àÂéü', key: 'Ê•öËæ≠„ÄÅÈõ¢È®∑„ÄÅÊÑõÂúãË©©‰∫∫' },
            { name: 'ËåÉ‰ª≤Ê∑π', key: 'Â≤≥ÈôΩÊ®ìË®ò„ÄÅÂÖàÂ§©‰∏ã‰πãÊÜÇËÄåÊÜÇ' },
            { name: 'ÊùéÊ∏ÖÁÖß', key: 'Â©âÁ¥ÑÊ¥æË©û‰∫∫„ÄÅËÅ≤ËÅ≤ÊÖ¢„ÄÅÈáëÁü≥ÈåÑ' },
            { name: 'ËæõÊ£ÑÁñæ', key: 'Ë±™ÊîæË©û„ÄÅÊÑõÂúãË©û‰∫∫„ÄÅÁ®ºËªíÈï∑Áü≠Âè•' }
        ];

        const CLASSICS = [
            '„ÄäÁ¥ÖÊ®ìÂ§¢„Äã', '„ÄäÊ∞¥Êª∏ÂÇ≥„Äã', '„Ää‰∏âÂúãÊºîÁæ©„Äã', '„ÄäË•øÈÅäË®ò„Äã', '„Ää‰∏ñË™™Êñ∞Ë™û„Äã', '„ÄäËÄÅÊÆòÈÅäË®ò„Äã', '„ÄäËÅäÈΩãË™åÁï∞„Äã', 
            '„ÄäÂÑíÊûóÂ§ñÂè≤„Äã', '„ÄäË©©Á∂ì„Äã', '„ÄäÊ•öËæ≠„Äã', '„ÄäÂ∑¶ÂÇ≥„Äã', '„ÄäÂè≤Ë®ò„Äã', '„ÄäÊº¢Êõ∏„Äã', '„ÄäÊà∞ÂúãÁ≠ñ„Äã', '„ÄäÂ§¢Ê∫™Á≠ÜË´á„Äã'
        ];

        const PHONETICS = [
            { word: '„ÄåË£®„ÄçÁõä', ans: '„ÑÖ„ÑßÀã' }, { word: '„ÄåË£®„ÄçÂ∞á', ans: '„ÑÜ„ÑßÀä' },
            { word: '„ÄåËºâ„ÄçÈáç', ans: '„Ñó„ÑûÀã' }, { word: 'Ë®ò„ÄåËºâ„Äç', ans: '„Ñó„ÑûÀá' },
            { word: '„ÄåÂìÑ„ÄçÂ†ÇÂ§ßÁ¨ë', ans: '„Ñè„Ñ®„Ñ•' }, { word: '„ÄåÂìÑ„ÄçÈ®ô', ans: '„Ñè„Ñ®„Ñ•Àá' },
            { word: 'Ëµ∑„ÄåÈ¨®„Äç', ans: '„Ñè„Ñ®„Ñ•Àã' }, { word: '„ÄåÂº∑„ÄçËø´', ans: '„Ñë„Ñß„Ñ§Àá' },
            { word: 'ÂÄî„ÄåÂº∑„Äç', ans: '„Ñê„Ñß„Ñ§Àã' }, { word: '„ÄåÂâµ„ÄçÂÇ∑', ans: '„Ñî„Ñ®„Ñ§' },
            { word: '„ÄåÂâµ„Äç‰Ωú', ans: '„Ñî„Ñ®„Ñ§Àã' }, { word: 'Á≤ó„ÄåÁç∑„Äç', ans: '„Ñç„Ñ®„Ñ§Àá' }
        ];

        const TYPOS = [
            { w: 'ÂÜçÊé•ÂÜçÂà©', r: 'ÂÜçÊé•ÂÜçÂé≤' }, { w: 'ÂêçÂàóÂâçËåÖ', r: 'ÂêçÂàóÂâçËåÖ' },
            { w: '‰∏ÄËÇ°‰ΩúÊ∞£', r: '‰∏ÄÈºì‰ΩúÊ∞£' }, { w: 'Ëø´‰∏çÂèäÂæÖ', r: 'Ëø´‰∏çÂèäÂæÖ' },
            { w: 'ÊåâÊ≠•Â∞±Áè≠', r: 'ÊåâÈÉ®Â∞±Áè≠' }, { w: 'Â∑ùÊµÅ‰∏çÊÅØ', r: 'Â∑ùÊµÅ‰∏çÊÅØ' },
            { w: 'ÁæéËº™ÁæéÁÖ•', r: 'ÁæéËº™ÁæéÂ•ê' }, { w: 'Âõ∫Ê≠•Ëá™Â∞Å', r: 'ÊïÖÊ≠•Ëá™Â∞Å' },
            { w: '‰∏çÂæëËÄåËµ∞', r: '‰∏çËÑõËÄåËµ∞' }, { w: 'ÂπÖÂì°Âª£Â§ß', r: 'ÂπÖÂì°Âª£Â§ß' }
        ];

        // -----------------------------------------------------------------------------
        // Helper: Fisher-Yates Shuffle
        // -----------------------------------------------------------------------------
        const fisherYatesShuffle = (array) => {
            let currentIndex = array.length, randomIndex;
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        };

        // -----------------------------------------------------------------------------
        // Generator Logic
        // -----------------------------------------------------------------------------
        const generateRealisticText = (type, variantCount) => {
            const rand = (arr) => arr[Math.floor(Math.random() * arr.length)];
            const shuffle = (arr) => [...arr].sort(() => 0.5 - Math.random());
            
            // Ê®ôË®òË§áÁøíÈ°å
            const isReview = variantCount > 0;
            const reviewLabel = isReview ? '„Äêüí°Ë§áÁøíÈ°å„Äë' : '';

            if (type === 'idiom') {
                const selectedIdioms = shuffle(IDIOMS).slice(0, 4);
                const target = selectedIdioms[0]; 
                return {
                    category: 'ÊàêË™ûÊáâÁî®',
                    text: `${reviewLabel} ‰∏ãÂàóÊñáÂè•„Äå„ÄçÂÖßÁöÑÊàêË™ûÔºå‰ΩøÁî®ÊúÄÊÅ∞Áï∂ÁöÑÊòØÔºö`,
                    options: [
                        `‰ªñÂÅö‰∫ãÁ∏ΩÊòØ„Äå${target}„ÄçÔºåÂõ†Ê≠§Ê∑±Áç≤‰∏äÂè∏Ë≥ûË≠ò„ÄÇ(ÂÅáË®≠Ê≠§ÁÇ∫Ê≠£Á¢∫ÊÉÖÂ¢É)`,
                        `Èù¢Â∞çÈÄôÊ®£ÁöÑÂç±Ê©üÔºåÊàëÂÄëÂè™ËÉΩ„Äå${selectedIdioms[1]}„ÄçÔºåÊØ´ÁÑ°Ëæ¶Ê≥ï„ÄÇ`,
                        `ÈÄôÂÆ∂È§êÂª≥ÁöÑËèúËâ≤ÁúüÊòØ„Äå${selectedIdioms[2]}„ÄçÔºåËÆì‰∫∫È£üÊåáÂ§ßÂãï„ÄÇ`,
                        `ÁúãÂà∞‰ªñÈÇ£„Äå${selectedIdioms[3]}„ÄçÁöÑÊ®£Â≠êÔºåÁúüËÆì‰∫∫ÊÑüÂà∞Â•ΩÁ¨ë„ÄÇ`
                    ],
                    explanation: `Êú¨È°åÊ∏¨È©óÊàêË™ûÁöÑÊ≠£Á¢∫‰ΩøÁî®ÊÉÖÂ¢É„ÄÇÈÅ∏È†Ö‰∏≠ÊàêË™û„Äå${target}„ÄçËàáË™ûÂ¢ÉÊúÄÁÇ∫Ë≤ºÂàá„ÄÇ`,
                    correctIndex: 0,
                    isReview
                };
            } else if (type === 'phonetic') {
                const pairs = shuffle(PHONETICS).slice(0, 4);
                return {
                    category: 'Â≠óÈü≥Ëæ®Êûê',
                    text: `${reviewLabel} ‰∏ãÂàó„Äå„ÄçÂÖßÁöÑÂ≠óÈü≥ÔºåÊ®ôÁ§∫Ê≠£Á¢∫ÁöÑÊòØÔºö`,
                    options: [
                        `${pairs[0].word}Ôºö${pairs[0].ans}`,
                        `${pairs[1].word}Ôºö${pairs[1].ans.replace('Àá', 'Àã').replace('Àã', 'Àä').replace('Àä', 'Àá')}`,
                        `${pairs[2].word}Ôºö${pairs[2].ans.replace('Àá', 'Àã').replace('Àã', 'Àä').replace('Àä', 'Àá')}`,
                        `${pairs[3].word}Ôºö${pairs[3].ans.replace('Àá', 'Àã').replace('Àã', 'Àä').replace('Àä', 'Àá')}`
                    ],
                    explanation: `Êú¨È°åÊ∏¨È©ó‰∏ÄÂ≠óÂ§öÈü≥„ÄÇÊ≠£Á¢∫ÈÅ∏È†ÖÁÇ∫ A„ÄÇ${pairs[0].word}ËÆÄ‰Ωú${pairs[0].ans}„ÄÇ`,
                    correctIndex: 0,
                    isReview
                };
            } else if (type === 'typo') {
                const words = shuffle(TYPOS).slice(0, 4);
                return {
                    category: 'Â≠óÂΩ¢Ëæ®Êûê',
                    text: `${reviewLabel} ‰∏ãÂàóË©ûË™û‰∏≠ÔºåÂÆåÂÖ®Ê≤íÊúâÈåØÂà•Â≠óÁöÑÊòØÔºö`,
                    options: [
                        `${words[0].r}`,
                        `${words[1].w}`,
                        `${words[2].w}`,
                        `${words[3].w}`
                    ],
                    explanation: `AÈÅ∏È†Ö„Äå${words[0].r}„ÄçÁî®Â≠óÊ≠£Á¢∫„ÄÇÂÖ∂‰ªñÈÅ∏È†ÖÊáâÁÇ∫Ôºö${words[1].r}„ÄÅ${words[2].r}„ÄÅ${words[3].r}„ÄÇ`,
                    correctIndex: 0,
                    isReview
                };
            } else if (type === 'literature') {
                const author = rand(AUTHORS);
                const otherAuthors = shuffle(AUTHORS.filter(a => a.name !== author.name)).slice(0, 3);
                return {
                    category: 'ÂúãÂ≠∏Â∏∏Ë≠ò',
                    text: `${reviewLabel} ÈóúÊñº${author.name}ÁöÑÊñáÂ≠∏ÊàêÂ∞±ËàáÁîüÂπ≥Ôºå‰∏ãÂàóÊïòËø∞‰ΩïËÄÖÊ≠£Á¢∫Ôºü`,
                    options: [
                        `${author.name}ÔºåÈóúÈçµË©ûÂåÖÂê´Ôºö${author.key}„ÄÇ`,
                        `${author.name}Ëàá${otherAuthors[0].name}ÂêàÁ®±Ôºå‰∏¶Á®±ÁÇ∫„Äå${otherAuthors[0].name.slice(0,1)}...„Äç„ÄÇ`,
                        `${author.name}ÊòØ${otherAuthors[1].name}ÁöÑÂ≠∏ÁîüÔºåÈ¢®Ê†ºÊ∑±ÂèóÂΩ±Èüø„ÄÇ`,
                        `${author.name}ËëóÊúâ„Ää${otherAuthors[2].name}ÈõÜ„ÄãÔºåÈ¢®Ê†ºÁ∂∫È∫ó„ÄÇ`
                    ],
                    explanation: `Êú¨È°åÊ∏¨È©óÂ∞ç${author.name}ÊñáÂ≠∏È¢®Ê†ºÁöÑÁêÜËß£„ÄÇ${author.name}‰ª•${author.key.split('„ÄÅ')[0]}ËëóÁ®±„ÄÇ`,
                    correctIndex: 0,
                    isReview
                };
            } else {
                const book = rand(CLASSICS);
                return {
                    category: 'Âè§ÂÖ∏Â∞èË™™',
                    text: `${reviewLabel} ÈóúÊñº${book}ÁöÑÂÖßÂÆπËàáÂØ´‰ΩúÁâπËâ≤Ôºå‰∏ãÂàóÊïòËø∞‰ΩïËÄÖÊ≠£Á¢∫Ôºü`,
                    options: [
                        `ÊòØ‰∏ÄÈÉ®Á´†ÂõûÈ´îÂ∞èË™™ÔºåÂÖßÂÆπÊèèÂØ´Á§æÊúÉÁôæÊÖã„ÄÇ`,
                        `‰ª•Á•ûÈ≠îÈ°åÊùêÁÇ∫‰∏ªÔºåÂØåÂê´Ë´∑Âà∫Á§æÊúÉÁèæÂØ¶ÁöÑÊÑèÂë≥„ÄÇ`,
                        `Êõ∏‰∏≠‰∫∫Áâ©ÊÄßÊ†ºÈÆÆÊòéÔºåÁµêÊßãÂÆèÂ§ßÂö¥Ë¨π„ÄÇ`,
                        `‰ª•Á¨¨‰∏Ä‰∫∫Á®±ËßÄÈªûÊïòËø∞ÔºåÈñãÂâµÂ∞èË™™Êñ∞Â±Ä„ÄÇ`
                    ],
                    explanation: `Êú¨È°åÊ∏¨È©óÂ∞ç‰∏≠ÂúãÂè§ÂÖ∏Â∞èË™™${book}ÁöÑÈ´îË£ÅËàáÂÖßÂÆπÂ§ßÊÑèÁöÑÊéåÊè°Á®ãÂ∫¶„ÄÇ`,
                    correctIndex: 0,
                    isReview
                };
            }
        };

        const generateMockQuestions = (startId, count) => {
            const mocks = [];
            const types = ['idiom', 'phonetic', 'typo', 'literature', 'classic'];
            let taskPool = [];
            
            // Âª∫Á´ã‰ªªÂãôÊ±†ÔºåÁ¢∫‰øùÂùáÂãªÂàÜ‰Ωà
            const loopsNeeded = Math.ceil(count / types.length) + 2; 
            for (let loop = 0; loop < loopsNeeded; loop++) {
                types.forEach(type => {
                    taskPool.push({ type, variantCount: loop });
                });
            }

            // ‰ΩøÁî® Fisher-Yates Ê¥óÁâå
            taskPool = fisherYatesShuffle(taskPool);
            const selectedTasks = taskPool.slice(0, count);

            selectedTasks.forEach((task, i) => {
                const isMulti = Math.random() > 0.85; 
                const content = generateRealisticText(task.type, task.variantCount);
                
                let finalOptions = content.options.map((text, idx) => ({ 
                    text, 
                    isCorrect: idx === content.correctIndex 
                }));
                finalOptions = fisherYatesShuffle(finalOptions);
                
                let correctIndices = [];
                finalOptions.forEach((opt, idx) => {
                    if (opt.isCorrect) correctIndices.push(idx);
                });

                if (isMulti) {
                    correctIndices = [0, 1]; 
                    content.explanation += " (Ê≠§È°åÁÇ∫Ê®°Êì¨Â§öÈÅ∏ÔºåÊ≠£Á¢∫Á≠îÊ°àÂåÖÂê´ A Ëàá B)";
                }

                const answerLabels = correctIndices.map(idx => String.fromCharCode(65 + idx)).join('„ÄÅ');

                mocks.push({
                    id: `mock_${startId + i}`,
                    type: isMulti ? 'multi' : 'single',
                    category: content.category,
                    text: `[Ê®°Êì¨ #${startId + i}] ${content.text}`,
                    options: finalOptions.map(o => o.text),
                    correctAnswer: correctIndices,
                    explanation: `„Äê${content.category}Ëß£Êûê„Äë${content.explanation} (Êú¨È°åÊ≠£Á¢∫ÈÅ∏È†ÖÁÇ∫ ${answerLabels})`,
                    difficulty: ['Êòì', '‰∏≠', 'Èõ£'][Math.floor(Math.random() * 3)],
                    isReview: content.isReview
                });
            });
            return mocks;
        };

        // -----------------------------------------------------------------------------
        // ‰∏ªÁ®ãÂºè
        // -----------------------------------------------------------------------------
        function ChineseExamApp() {
            const [currentScreen, setCurrentScreen] = useState('home'); 
            const [questions, setQuestions] = useState([]);
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [userAnswers, setUserAnswers] = useState({});
            const [markedQuestions, setMarkedQuestions] = useState(new Set()); 
            const [showExplanation, setShowExplanation] = useState(false);
            const [showGrid, setShowGrid] = useState(false); 

            useEffect(() => {
                let flattened = [];
                REAL_QUESTION_EXAMPLES.forEach(item => {
                    if (item.type === 'group') {
                        item.questions.forEach(q => {
                            flattened.push({
                                ...q,
                                groupTitle: item.passageTitle,
                                groupContent: item.passageContent,
                                isGroup: true
                            });
                        });
                    } else {
                        flattened.push(item);
                    }
                });

                const currentCount = flattened.length;
                const needed = 500 - currentCount;
                if (needed > 0) {
                    const mocks = generateMockQuestions(currentCount + 1, needed);
                    flattened = [...flattened, ...mocks];
                }

                setQuestions(flattened);
            }, []);

            const startExam = () => {
                setCurrentQuestionIndex(0);
                setUserAnswers({});
                setMarkedQuestions(new Set());
                setShowExplanation(false);
                setShowGrid(false);
                setCurrentScreen('quiz');
            };

            const handleAnswerSelect = (optionIndex, isMulti) => {
                if (showExplanation) return; 

                const currentQ = questions[currentQuestionIndex];
                const qId = currentQ.id;
                
                setUserAnswers(prev => {
                    const currentSelected = prev[qId] || [];
                    if (isMulti) {
                        if (currentSelected.includes(optionIndex)) {
                            return { ...prev, [qId]: currentSelected.filter(i => i !== optionIndex) };
                        } else {
                            return { ...prev, [qId]: [...currentSelected, optionIndex].sort() };
                        }
                    } else {
                        return { ...prev, [qId]: [optionIndex] };
                    }
                });

                if (!isMulti) {
                    setShowExplanation(true);
                }
            };

            const toggleMarkQuestion = () => {
                const qId = questions[currentQuestionIndex].id;
                setMarkedQuestions(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(qId)) newSet.delete(qId);
                    else newSet.add(qId);
                    return newSet;
                });
            };

            const calculateScore = () => {
                let rawScore = 0;
                questions.forEach(q => {
                    const userAns = userAnswers[q.id] || [];
                    const correctAns = q.correctAnswer;
                    const isCorrect = userAns.length === correctAns.length && userAns.every(val => correctAns.includes(val));
                    if (isCorrect) rawScore++;
                });
                const percentage = (rawScore / questions.length) * 100;
                let rank = 0;
                if (percentage >= 90) rank = 15;
                else if (percentage >= 85) rank = 14;
                else if (percentage >= 80) rank = 13;
                else if (percentage >= 70) rank = 11;
                else if (percentage >= 60) rank = 9;
                else rank = Math.floor(percentage / 10) + 1;

                return { rawScore, total: questions.length, rank, percentage };
            };

            // ---------------------------------------------------------------------------
            // ÂÖÉ‰ª∂
            // ---------------------------------------------------------------------------

            const QuestionGrid = ({ closeGrid }) => (
                <div className="fixed inset-0 bg-black/50 z-50 flex justify-end animate-fade-in">
                    <div className="w-full max-w-sm bg-white h-full shadow-2xl flex flex-col animate-slide-in-right">
                        <div className="p-4 border-b flex justify-between items-center bg-gray-50">
                            <h3 className="font-bold text-lg text-gray-800 flex items-center">
                                <Icons.Grid size={20} className="mr-2"/> È°åÁõÆÂ∞éËà™
                            </h3>
                            <button onClick={closeGrid} className="p-2 hover:bg-gray-200 rounded-full">
                                <Icons.XCircle size={24} className="text-gray-500"/>
                            </button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4">
                            <div className="grid grid-cols-5 gap-3">
                                {questions.map((q, idx) => {
                                    const isAnswered = userAnswers[q.id] && userAnswers[q.id].length > 0;
                                    const isMarked = markedQuestions.has(q.id);
                                    const isCurrent = currentQuestionIndex === idx;
                                    let btnClass = "h-10 w-10 rounded-lg flex items-center justify-center text-sm font-medium transition relative ";
                                    if (isCurrent) btnClass += "ring-2 ring-blue-500 ring-offset-2 bg-blue-100 text-blue-700 font-bold ";
                                    else if (isAnswered) btnClass += "bg-blue-600 text-white shadow-sm ";
                                    else btnClass += "bg-gray-100 text-gray-500 hover:bg-gray-200 ";

                                    return (
                                        <button 
                                            key={q.id} 
                                            onClick={() => { setCurrentQuestionIndex(idx); setShowExplanation(false); closeGrid(); }}
                                            className={btnClass}
                                        >
                                            {idx + 1}
                                            {isMarked && <span className="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border border-white"></span>}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                </div>
            );

            if (currentScreen === 'home') return (
                <div className="flex flex-col items-center justify-center h-full p-6 space-y-8 animate-fade-in bg-gradient-to-br from-blue-50 to-indigo-50">
                    <div className="text-center space-y-4 max-w-lg">
                        <div className="bg-white p-6 rounded-2xl shadow-lg inline-block mb-2">
                            <Icons.BookOpen size={64} className="text-blue-600" />
                        </div>
                        <h1 className="text-4xl font-extrabold text-gray-800 tracking-tight">108Ë™≤Á∂±Â≠∏Ê∏¨ÂúãÊñá</h1>
                        <p className="text-xl text-gray-600 font-medium">ÂÖ®ÈÅ∏ÊìáÈ°åÊ®°Êì¨Á≥ªÁµ± (500È°åÁâà)</p>
                        <div className="flex flex-wrap justify-center gap-2 mt-4">
                           <span className="px-3 py-1 bg-white border border-gray-200 rounded-full text-sm text-gray-500">Â≠óÈü≥Â≠óÂΩ¢</span>
                           <span className="px-3 py-1 bg-white border border-gray-200 rounded-full text-sm text-gray-500">Èñ±ËÆÄÈ°åÁµÑ</span>
                           <span className="px-3 py-1 bg-white border border-gray-200 rounded-full text-sm text-gray-500">Ê∑∑ÂêàÈ°åÂûã</span>
                        </div>
                    </div>
                    <div className="w-full max-w-sm">
                        <button 
                            onClick={startExam}
                            className="w-full flex items-center justify-center p-5 bg-blue-600 text-white rounded-xl shadow-lg hover:bg-blue-700 hover:shadow-xl transition transform hover:-translate-y-1 group"
                        >
                            <div className="bg-white/20 p-2 rounded-full mr-3 group-hover:scale-110 transition">
                                <Icons.Zap size={24} className="text-white" />
                            </div>
                            <div className="text-left">
                                <span className="block font-bold text-xl">ÈñãÂßãÂà∑È°å</span>
                                <span className="text-sm text-blue-100">500È°åÂ∫´ ‚Ä¢ ÁÑ°Â£ìÂäõÊ®°Âºè</span>
                            </div>
                        </button>
                    </div>
                </div>
            );

            if (currentScreen === 'result') {
                const { rawScore, total, rank, percentage } = calculateScore();
                return (
                    <div className="flex flex-col items-center h-full bg-gray-50 p-6 overflow-y-auto">
                        <div className="w-full max-w-md space-y-6 mt-8">
                            <div className="bg-white rounded-3xl shadow-xl p-8 text-center relative overflow-hidden">
                                <h2 className="text-3xl font-extrabold text-gray-800 mb-2">Á∑¥ÁøíÂÆåÊàê</h2>
                                <div className="flex justify-center my-8">
                                    <div className="text-6xl font-black text-gray-800">{percentage.toFixed(0)}<span className="text-2xl text-gray-400 font-normal">ÂàÜ</span></div>
                                </div>
                                <div className="grid grid-cols-2 gap-4 text-left">
                                    <div className="bg-blue-50 p-4 rounded-2xl">
                                        <p className="text-xs text-blue-400 font-bold mb-1">Á≠îÂ∞çÈ°åÊï∏</p>
                                        <p className="text-2xl font-bold text-blue-900">{rawScore} / {total}</p>
                                    </div>
                                    <div className="bg-indigo-50 p-4 rounded-2xl">
                                        <p className="text-xs text-indigo-400 font-bold mb-1">Ê®°Êì¨Á¥öÂàÜ</p>
                                        <p className="text-2xl font-bold text-indigo-900">{rank}</p>
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-3">
                                <button onClick={() => setCurrentScreen('home')} className="w-full bg-gray-800 hover:bg-gray-900 text-white py-4 rounded-2xl font-bold shadow-lg transition flex items-center justify-center space-x-2">
                                    <Icons.RotateCcw size={20} /> <span>ËøîÂõûÈ¶ñÈ†Å</span>
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            const q = questions[currentQuestionIndex];
            if (!q) return <div className="flex items-center justify-center h-full text-xl text-gray-500">ËºâÂÖ•È°åÂ∫´‰∏≠...</div>;

            const isMulti = q.type === 'multi' || (q.correctAnswer && q.correctAnswer.length > 1);
            const currentAns = userAnswers[q.id] || [];
            const isMarked = markedQuestions.has(q.id);

            return (
                <div className="flex flex-col h-full bg-gray-50 relative">
                    {showGrid && <QuestionGrid closeGrid={() => setShowGrid(false)} />}
                    <div className="bg-white shadow-sm px-4 py-3 flex justify-between items-center sticky top-0 z-10 border-b border-gray-100">
                        <div className="flex items-center space-x-3">
                            <button onClick={() => setCurrentScreen('home')} className="p-2 hover:bg-gray-100 rounded-lg text-gray-500">
                                <Icons.Home size={20} />
                            </button>
                            <button onClick={() => setShowGrid(true)} className="flex items-center space-x-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-lg transition text-gray-700 font-medium">
                                <Icons.Grid size={18} />
                                <span>{currentQuestionIndex + 1} / {questions.length}</span>
                            </button>
                        </div>
                        <button onClick={toggleMarkQuestion} className={`p-2 rounded-lg transition ${isMarked ? 'bg-red-100 text-red-500' : 'text-gray-400 hover:bg-gray-100'}`}>
                            <Icons.Flag size={20} fill={isMarked ? "currentColor" : "none"} />
                        </button>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 md:p-6 max-w-4xl mx-auto w-full scroll-smooth">
                        {q.isGroup && (
                            <div className="bg-white rounded-xl p-6 mb-6 shadow-sm border-l-4 border-indigo-500">
                                <div className="flex items-center justify-between mb-3">
                                    <h3 className="font-bold text-lg text-indigo-900">{q.groupTitle}</h3>
                                    <span className="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded">Èñ±ËÆÄÈ°åÁµÑ</span>
                                </div>
                                <div className="prose prose-sm md:prose-base max-w-none text-gray-700 leading-relaxed whitespace-pre-wrap font-serif">
                                    {q.groupContent}
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-xl p-6 shadow-sm ring-1 ring-gray-100">
                            <div className="flex items-center space-x-2 mb-4">
                                <span className={`text-xs font-bold px-2 py-1 rounded ${isMulti ? 'bg-orange-100 text-orange-700' : 'bg-blue-100 text-blue-700'}`}>
                                    {isMulti ? 'Â§öÈÅ∏È°å' : 'ÂñÆÈÅ∏È°å'}
                                </span>
                                <span className="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded">
                                    {q.category}
                                </span>
                                {q.isReview && <span className="text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded border border-amber-200 flex items-center animate-pulse"><Icons.Flag size={12} className="mr-1" /> Ë§áÁøíËÆäÈ´î</span>}
                            </div>

                            <h2 className="text-xl font-medium text-gray-900 mb-8 leading-relaxed">
                                {q.text}
                            </h2>

                            <div className="space-y-4">
                                {q.options.map((option, idx) => {
                                    const isSelected = currentAns.includes(idx);
                                    let btnClass = "w-full text-left p-4 rounded-xl border-2 transition-all flex items-start space-x-4 relative overflow-hidden ";
                                    if (showExplanation) {
                                        if (q.correctAnswer.includes(idx)) btnClass += "border-green-500 bg-green-50 text-green-900";
                                        else if (isSelected) btnClass += "border-red-500 bg-red-50 text-red-900";
                                        else btnClass += "border-gray-100 text-gray-400 opacity-60";
                                    } else {
                                        if (isSelected) btnClass += "border-blue-500 bg-blue-50 text-blue-900 shadow-md transform scale-[1.01]";
                                        else btnClass += "border-gray-200 hover:border-blue-300 hover:bg-gray-50 text-gray-700";
                                    }

                                    return (
                                        <button key={idx} onClick={() => handleAnswerSelect(idx, isMulti)} className={btnClass} disabled={showExplanation}>
                                            <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 text-sm font-bold border-2 transition-colors ${
                                                isSelected ? 'bg-blue-500 border-blue-500 text-white' : 'border-gray-300 text-gray-500'
                                            } ${showExplanation && q.correctAnswer.includes(idx) ? '!bg-green-500 !border-green-500 !text-white' : ''}`}>
                                                {String.fromCharCode(65 + idx)}
                                            </div>
                                            <span className="pt-1">{option}</span>
                                        </button>
                                    );
                                })}
                            </div>

                            {showExplanation && (
                                <div className="mt-8 bg-yellow-50 p-5 rounded-xl border border-yellow-200 animate-fade-in-up">
                                    <div className="flex items-center space-x-2 text-yellow-800 font-bold mb-3">
                                        <Icons.Award size={20} />
                                        <span>Ëß£ÊûêËàáË©≥Ëß£</span>
                                    </div>
                                    <p className="text-gray-800 leading-relaxed">{q.explanation}</p>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="bg-white border-t border-gray-100 p-4 flex justify-between items-center safe-area-bottom">
                        <button 
                            onClick={() => { setShowExplanation(false); setCurrentQuestionIndex(prev => Math.max(0, prev - 1)); }}
                            disabled={currentQuestionIndex === 0}
                            className="flex items-center space-x-2 px-4 py-2 rounded-full text-gray-600 hover:bg-gray-100 disabled:opacity-30 transition"
                        >
                            <Icons.ChevronLeft size={20} /> <span>‰∏ä‰∏ÄÈ°å</span>
                        </button>
                        {!showExplanation ? (
                            isMulti ? (
                                <button onClick={() => setShowExplanation(true)} className="bg-orange-500 hover:bg-orange-600 text-white px-8 py-2.5 rounded-full font-bold shadow-md transition">
                                    Á¢∫Ë™çÁ≠îÊ°à
                                </button>
                            ) : (
                                <span className="text-sm text-gray-400 font-medium hidden md:block animate-pulse">Ë´ãÈªûÈÅ∏ÈÅ∏È†Ö</span>
                            )
                        ) : (
                            <button 
                                onClick={() => {
                                    if (currentQuestionIndex < questions.length - 1) { setShowExplanation(false); setCurrentQuestionIndex(prev => prev + 1); } 
                                    else { setCurrentScreen('result'); setShowGrid(false); }
                                }}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-8 py-2.5 rounded-full font-bold shadow-md flex items-center transition"
                            >
                                {currentQuestionIndex === questions.length - 1 ? 'Êü•ÁúãÊàêÁ∏æ' : '‰∏ã‰∏ÄÈ°å'} <Icons.ChevronRight size={18} className="ml-1"/>
                            </button>
                        )}
                        {(!showExplanation && !isMulti) && <div className="w-20 md:hidden"></div>}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ChineseExamApp />);
    </script>
</body>
</html>